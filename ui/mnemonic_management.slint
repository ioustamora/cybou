// Mnemonic Management Window
import { Button, GroupBox, HorizontalBox, ScrollView, TextEdit, VerticalBox } from "std-widgets.slint";

export component MnemonicManagement inherits Window {
    title: "Cybou - Mnemonic Management";
    width: 600px;
    height: 400px;

    in-out property <string> mnemonic-input: "";
    in-out property <string> status-text: "Enter your 12 or 24-word BIP39 mnemonic phrase";
    in-out property <bool> is-valid: false;
    in-out property <bool> keys-loaded: false;
    in-out property <string> public-key-display: "";

    callback generate-mnemonic(int);
    callback validate-mnemonic(string);
    callback continue-with-mnemonic();
    callback copy-mnemonic();
    callback copy-mnemonic_when_loaded();
    callback copy-public-keys();
    callback clear-mnemonic();
    callback show-help(string);

    VerticalBox {
        // Header with help button
        HorizontalBox {
            Text {
                text: "ðŸ”‘ Mnemonic Management";
                font-size: 18px;
                font-weight: 600;
            }
            HorizontalBox { width: 1px; } // Spacer
            Button {
                text: "?";
                width: 30px;
                height: 30px;
                clicked => { show-help("mnemonic-management"); }
            }
        }

        // Separator
        Rectangle { height: 1px; background: #cccccc; }

        // Main Content
        ScrollView {
            VerticalBox {
                // Mnemonic Input Section
                GroupBox {
                    title: "ðŸ“ Enter Mnemonic Phrase";

                    VerticalBox {
                        HorizontalBox {
                            Text {
                                text: "Enter your 12 or 24-word BIP39 mnemonic phrase below.";
                            }
                            HorizontalBox { width: 1px; } // Spacer
                            Button {
                                text: "?";
                                width: 20px;
                                height: 20px;
                                clicked => { show-help("mnemonic-input"); }
                            }
                        }

                        TextEdit {
                            text: mnemonic-input;
                            placeholder-text: "e.g., abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about";
                            wrap: word-wrap;
                            height: 80px;
                            edited(text) => { validate-mnemonic(text); }
                        }

                        // Action buttons - only show when mnemonic is not valid
                        if (!is-valid): HorizontalBox {
                            Button {
                                text: "ðŸŽ² 12 Words";
                                clicked => { generate-mnemonic(12); }
                            }
                            Button {
                                text: "ðŸŽ² 24 Words";
                                clicked => { generate-mnemonic(24); }
                            }
                            Button {
                                text: "ðŸ—‘ï¸ Clear";
                                clicked => { clear-mnemonic(); }
                            }
                            Button {
                                text: "ðŸ“‹ Copy";
                                clicked => { copy-mnemonic(); }
                            }
                        }

                        // Continue button - show when mnemonic is valid
                        if (is-valid): HorizontalBox {
                            Button {
                                text: "ðŸš€ Continue";
                                clicked => { continue-with-mnemonic(); }
                                width: 120px;
                            }
                            if (keys-loaded): Button {
                                text: "ðŸ“‹ Copy Mnemonic";
                                clicked => { copy-mnemonic_when_loaded(); }
                                width: 140px;
                            }
                        }
                    }
                }

                // Validation Status
                GroupBox {
                    title: "ðŸ” Status";

                    VerticalBox {
                        Text {
                            text: status-text;
                            color: is-valid ? #00aa00 : #aa0000;
                            font-weight: is-valid ? 600 : 400;
                        }

                        if (keys-loaded): Text {
                            text: "âœ… Keys loaded successfully!";
                            color: #00aa00;
                            font-weight: 600;
                        }
                    }
                }

                // Public Key Display
                if (keys-loaded): GroupBox {
                    title: "ðŸ” Public Key";

                    VerticalBox {
                        Text {
                            text: "Your public key identifier:";
                            font-weight: 600;
                        }
                        HorizontalBox {
                            Text {
                                text: public-key-display;
                                font-family: "monospace";
                                font-size: 12px;
                                color: #0066cc;
                            }
                            HorizontalBox { width: 1px; } // Spacer
                            Button {
                                text: "ðŸ“‹ Copy";
                                width: 60px;
                                height: 25px;
                                clicked => { copy-public-keys(); }
                            }
                        }
                        Text {
                            text: "This compact identifier helps you verify which keys are loaded.";
                            font-size: 11px;
                            color: #666666;
                        }
                    }
                }
            }
        }

        // Separator
        Rectangle { height: 1px; background: #cccccc; }

        // Status Bar
        HorizontalBox {
            Text { text: "ðŸ“Š Status:"; }
            Text {
                text: status-text;
                color: is-valid ? #00aa00 : #666666;
            }
        }
    }
}